<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Chapter 5 視覺化：ggplot2 | RLads Lab</title>
<meta name="author" content="Yongfu Liao">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.2"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/header-attrs-2.7.3/header-attrs.js"></script><script src="libs/jquery-3.5.1/jquery-3.5.1.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.5.3/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.5.3/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.4/tabs.js"></script><script src="libs/bs3compat-0.2.4/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script><link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet">
<script src="libs/str_view-binding-1.4.0/str_view.js"></script><script src="https://cdn.jsdelivr.net/autocomplete.js/0/autocomplete.jquery.min.js"></script><script src="https://cdn.jsdelivr.net/npm/mark.js@8.11.1/dist/mark.min.js"></script><!-- CSS --><link rel="stylesheet" href="style.css">
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">RLads Lab</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">關於</a></li>
<li><a class="" href="ch01.html"><span class="header-section-number">1</span> 掌握你的電腦</a></li>
<li><a class="" href="ch02.html"><span class="header-section-number">2</span> Base R (I) &amp; 輔助工具</a></li>
<li><a class="" href="ch03.html"><span class="header-section-number">3</span> Base R (II)</a></li>
<li><a class="" href="ch04.html"><span class="header-section-number">4</span> Data Frame 處理：dplyr</a></li>
<li><a class="active" href="ch05.html"><span class="header-section-number">5</span> 視覺化：ggplot2</a></li>
<li><a class="" href="ch06.html"><span class="header-section-number">6</span> Simulating Data with R</a></li>
<li><a class="" href="ch07.html"><span class="header-section-number">7</span> 字串處理</a></li>
<li><a class="" href="ch08.html"><span class="header-section-number">8</span> 中文文本資料處理</a></li>
<li><a class="" href="ch09.html"><span class="header-section-number">9</span> 文本與詞彙的向量表徵</a></li>
<li><a class="" href="ch10.html"><span class="header-section-number">10</span> 擷取網路資料：Web API</a></li>
<li><a class="" href="ch11.html"><span class="header-section-number">11</span> 擷取網路資料：網頁剖析</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/rlads2021/LabBook">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="ch05" class="section level1" number="5">
<h1>
<span class="header-section-number">5</span> 視覺化：ggplot2<a class="anchor" aria-label="anchor" href="#ch05"><i class="fas fa-link"></i></a>
</h1>
<p><span class="course-resource">(<a href="https://docs.google.com/presentation/d/1sLEjDnnJ9odpFuK6b42HVoatOQnwhokSDeLg25PiZVU">投影片</a> /
<a href="https://youtu.be/lLoOTHNap34">影片</a>)</span><br><span class="additional-notes">Some of the material is based on <a href="https://github.com/rstudio-education/welcome-to-the-tidyverse/tree/master/02-Visualize">Garrett Grolemund’s introduction to ggplot2</a></span></p>
<div id="r-的繪圖系統" class="section level2" number="5.1">
<h2>
<span class="header-section-number">5.1</span> R 的繪圖系統<a class="anchor" aria-label="anchor" href="#r-%E7%9A%84%E7%B9%AA%E5%9C%96%E7%B3%BB%E7%B5%B1"><i class="fas fa-link"></i></a>
</h2>
<p>眾所皆知，R 語言的繪圖能力非常強大。相較其它統計套裝軟體，R 讓使用者能對圖的細部做許多調整，甚至去創造出獨特的圖片 (i.e. 不屬於傳統統計圖範疇內的圖)。</p>
<p>但隨著強大繪圖功能伴隨而來的便是異常複雜的繪圖函數。傳統的 R 即擁有很厲害的繪圖系統：base R graphics 與 lattice 套件皆是功能非常強大的繪圖系統，但其學習曲線也相當陡峭，因此，實習課僅會介紹 <code>ggplot2</code> 這個較易上手 (但功能仍相當強大) 的繪圖系統 (套件)。</p>
</div>
<div id="今天用到的資料-diamonds" class="section level2" number="5.2">
<h2>
<span class="header-section-number">5.2</span> 今天用到的資料: <code>diamonds</code><a class="anchor" aria-label="anchor" href="#%E4%BB%8A%E5%A4%A9%E7%94%A8%E5%88%B0%E7%9A%84%E8%B3%87%E6%96%99-diamonds"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<code>diamonds</code> 是 <code>ggplot2</code> 套件的內建資料。這筆資料記錄著 5 萬多筆鑽石的售價以及各種資訊。可使用 <code><a href="https://ggplot2.tidyverse.org/reference/diamonds.html">?diamonds</a></code> 閱讀此資料各變項的說明。</li>
</ul>
<div class="inline-table"><table class="table table-sm">
<thead><tr class="header">
<th align="center">carat</th>
<th align="center">cut</th>
<th align="center">color</th>
<th align="center">clarity</th>
<th align="center">depth</th>
<th align="center">table</th>
<th align="center">price</th>
<th align="center">x</th>
<th align="center">y</th>
<th align="center">z</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="center">0.23</td>
<td align="center">Ideal</td>
<td align="center">E</td>
<td align="center">SI2</td>
<td align="center">61.5</td>
<td align="center">55</td>
<td align="center">326</td>
<td align="center">3.95</td>
<td align="center">3.98</td>
<td align="center">2.43</td>
</tr>
<tr class="even">
<td align="center">0.21</td>
<td align="center">Premium</td>
<td align="center">E</td>
<td align="center">SI1</td>
<td align="center">59.8</td>
<td align="center">61</td>
<td align="center">326</td>
<td align="center">3.89</td>
<td align="center">3.84</td>
<td align="center">2.31</td>
</tr>
<tr class="odd">
<td align="center">0.23</td>
<td align="center">Good</td>
<td align="center">E</td>
<td align="center">VS1</td>
<td align="center">56.9</td>
<td align="center">65</td>
<td align="center">327</td>
<td align="center">4.05</td>
<td align="center">4.07</td>
<td align="center">2.31</td>
</tr>
<tr class="even">
<td align="center">0.29</td>
<td align="center">Premium</td>
<td align="center">I</td>
<td align="center">VS2</td>
<td align="center">62.4</td>
<td align="center">58</td>
<td align="center">334</td>
<td align="center">4.20</td>
<td align="center">4.23</td>
<td align="center">2.63</td>
</tr>
<tr class="odd">
<td align="center">0.31</td>
<td align="center">Good</td>
<td align="center">J</td>
<td align="center">SI2</td>
<td align="center">63.3</td>
<td align="center">58</td>
<td align="center">335</td>
<td align="center">4.34</td>
<td align="center">4.35</td>
<td align="center">2.75</td>
</tr>
<tr class="even">
<td align="center">0.24</td>
<td align="center">Very Good</td>
<td align="center">J</td>
<td align="center">VVS2</td>
<td align="center">62.8</td>
<td align="center">57</td>
<td align="center">336</td>
<td align="center">3.94</td>
<td align="center">3.96</td>
<td align="center">2.48</td>
</tr>
</tbody>
</table></div>
<p>因為 <code>diamonds</code> 相當龐大，為減少運算時間，這裡從 <code>diamonds</code> 抽出 1500 筆資料儲存於 <code>diam</code></p>
<div class="sourceCode" id="cb310"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org">dplyr</a></span><span class="op">)</span>
<span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="va">diam</span> <span class="op">&lt;-</span> <span class="va">diamonds</span> <span class="op">%&gt;%</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/sample_n.html">sample_n</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1500</span><span class="op">)</span></code></pre></div>
</div>
<div id="template-1" class="section level2" number="5.3">
<h2>
<span class="header-section-number">5.3</span> Template 1<a class="anchor" aria-label="anchor" href="#template-1"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>最基本的 ggplot 模板：</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb311-1"><a href="ch05.html#cb311-1" aria-hidden="true"></a><span class="kw">ggplot</span>(<span class="dt">data =</span> <span class="op">&lt;</span>DATA<span class="op">&gt;</span>) <span class="op">+</span></span>
<span id="cb311-2"><a href="ch05.html#cb311-2" aria-hidden="true"></a><span class="st">  </span><span class="er">&lt;</span>GEOM_FUNCTION<span class="op">&gt;</span>(<span class="dt">mapping =</span> <span class="kw">aes</span>(<span class="op">&lt;</span>MAPPINGS<span class="op">&gt;</span>))</span></code></pre></div>
</li>
<li>
<p>使用模板繪製散布圖：</p>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-88"></span>
<img src="assets/img/ggplot_labels.png" alt="`ggplot()` 的結構" width="100%"><p class="caption">
Figure 5.1: <code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code> 的結構
</p>
</div>
</li>
</ul>
<div id="散布圖-scatter-plot" class="section level3" number="5.3.1">
<h3>
<span class="header-section-number">5.3.1</span> 散布圖 (Scatter plot)<a class="anchor" aria-label="anchor" href="#%E6%95%A3%E5%B8%83%E5%9C%96-scatter-plot"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>
<p>使用下方程式碼，可繪製出鑽石的<strong>重量 (克拉)</strong> 與<strong>價錢 (美元)</strong> 的關係 (散布圖)</p>
<div class="sourceCode" id="cb312"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://ggplot2.tidyverse.org">ggplot2</a></span><span class="op">)</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-89-1.png" width="75%" style="display: block; margin: auto;"></div>
</li>
</ul>
</div>
</div>
<div id="圖層" class="section level2" number="5.4">
<h2>
<span class="header-section-number">5.4</span> 圖層<a class="anchor" aria-label="anchor" href="#%E5%9C%96%E5%B1%A4"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>在 ggplot 的概念中，圖片是由<strong>一層層</strong>的<strong>圖層</strong>堆疊起來的：
<ol style="list-style-type: decimal">
<li>
<p>第一層 (<code><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot()</a></code>) 是底圖 (初始化繪圖函數)。在這層定義的內容 (e.g. <code>data</code>) 可被之後的圖層使用。</p>
<div class="sourceCode" id="cb313"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span>   <span class="co"># 底層</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-90-1.png" width="75%" style="display: block; margin: auto;"></div>
</li>
<li>
<p>第二層 (<code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code>) 畫在底圖之上。圖層之間以 <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code> 連結起來,要將第一與第二層連起來，得在繪製第一層圖層的程式碼<strong>之後</strong>加上一個 <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>：</p>
<div class="sourceCode" id="cb314"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>                                <span class="co"># 底層</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span>    <span class="co"># 第二層</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-91-1.png" width="75%" style="display: block; margin: auto;"></div>
</li>
<li>
<p>如果想<strong>增加其它圖層</strong>，只要再繼續使用 <code><a href="https://rdrr.io/r/base/Arithmetic.html">+</a></code>:</p>
<div class="sourceCode" id="cb315"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>                                <span class="co"># 底層</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>  <span class="co"># 第二層</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_smooth.html">geom_smooth</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span>   <span class="co"># 第三層</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-92-1.png" width="75%" style="display: block; margin: auto;"></div>
</li>
</ol>
</li>
</ul>
</div>
<div id="mapping-將資料對應至視覺屬性" class="section level2" number="5.5">
<h2>
<span class="header-section-number">5.5</span> Mapping: 將資料對應至視覺屬性<a class="anchor" aria-label="anchor" href="#mapping-%E5%B0%87%E8%B3%87%E6%96%99%E5%B0%8D%E6%87%89%E8%87%B3%E8%A6%96%E8%A6%BA%E5%B1%AC%E6%80%A7"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li><p>要能繪製統計圖，必須先將抽象的資料 (i.e. data frame) <strong>對應</strong>至實際可見的視覺屬性上 (e.g. 位置、形狀、大小、顏色、透明度等) 。不同的統計圖，所需的「資料與視覺屬性間的對應關係」就不同。</p></li>
<li><p>要繪製一個散布圖，我們必須將 data frame 中的一個變項對應至 x 軸、另一個變項對應至 y 軸，以將 data frame 中的每筆觀察值 (抽象資料) 轉換成圖上的一個個點 (視覺屬性)</p></li>
<li>
<p><code>geom_*()</code> 中的參數 <code>mapping</code>，即在定義「data frame 中的資料與統計圖上之視覺屬性的關係」：</p>
<div class="sourceCode" id="cb316"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span>, y <span class="op">=</span> <span class="va">price</span>, color <span class="op">=</span> <span class="va">clarity</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-93-1.png" width="75%" style="display: block; margin: auto;"></div>
<ul>
<li>在 <code><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes()</a></code> 裡面定義資料與視覺屬性間的關係
<ul>
<li>
<code>x = carat</code>: 將 <code>diam</code> 中的變項 <code>carat</code> 對應至散布圖的 x 軸</li>
<li>
<code>y = price</code>: 將 <code>diam</code> 中的變項 <code>price</code> 對應至散布圖的 y 軸</li>
<li>
<code>x</code> 與 <code>y</code> 會共同決定一個點的位置</li>
<li>
<code>color = clarity</code>: 將 <code>diam</code> 中的變項 <code>clarity</code> 對應至散布圖上<strong>點的顏色</strong>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-94"></span>
<img src="assets/img/mappings.png" alt="Aesthetic Mappings" width="70%"><p class="caption">
Figure 5.2: Aesthetic Mappings
</p>
</div>
</div>
<div id="長條圖-bar-chart" class="section level2" number="5.6">
<h2>
<span class="header-section-number">5.6</span> 長條圖 (Bar chart)<a class="anchor" aria-label="anchor" href="#%E9%95%B7%E6%A2%9D%E5%9C%96-bar-chart"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>概念上，繪製長條圖與繪製散布圖是很不一樣的：</p>
<ul>
<li>散布圖上的視覺屬性可以<strong>直接對應</strong>到 data frame 裡的資料</li>
<li>長條圖的視覺屬性 (bar 的長度) <strong>無法直接對應</strong>到 data frame 裡的資料。它對應到的是由 data frame 裡的資料<strong>經過彙整的結果</strong>:
<ul>
<li>x 軸上是某變項裡的<strong>各個類別</strong>組成的</li>
<li>y 軸代表各個類別<strong>出現的次數</strong>
</li>
</ul>
</li>
</ul>
</li>
<li>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 是用來繪製長條圖的函數。在定義 <code>mapping</code> 時，只需將 data frame 的某個變項 (通常為類別變項) 對應至 <code>x</code>，<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 即會<strong>自動依據此變項計算出各類別的次數</strong>。換言之，在生成的長條圖中，y 軸 (<code>count</code>) 並非 data frame 的變項，而是 <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 幫你計算出來的東西，因此在定義 mapping 時，不需定義變項與 y 軸間的 mapping。</p>
<div class="sourceCode" id="cb317"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span> 
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cut</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-95-1.png" width="75%" style="display: block; margin: auto;"></div>
</li>
<li>
<p><code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 在繪製長條圖之前，為符合繪圖需求而將傳入的 data frame 進行的運算，稱為 Statistical Transformation:</p>
<div class="figure" style="text-align: center">
<span id="fig:unnamed-chunk-96"></span>
<img src="assets/img/visualization-stat-bar.png" alt="`geom_bar()`'s default statistical transformation[^src]" width="100%"><p class="caption">
Figure 5.3: <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code>’s default statistical transformation<a class="footnote-ref" tabindex="0" data-toggle="popover" data-content='&lt;p&gt;Source: &lt;a href="https://r4ds.had.co.nz/data-visualisation.html#statistical-transformations" class="uri"&gt;https://r4ds.had.co.nz/data-visualisation.html#statistical-transformations&lt;/a&gt;&lt;/p&gt;'><sup>13</sup></a>
</p>
</div>
</li>
</ul>
</div>
<div id="statistical-transformations" class="section level2" number="5.7">
<h2>
<span class="header-section-number">5.7</span> Statistical Transformations<a class="anchor" aria-label="anchor" href="#statistical-transformations"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>有時候，我們<strong>只能拿到已整理好的資料</strong>，換言之，我們無法從 <code>x</code> 裡面去計算出裡面各類別的次數 (<code>count</code>)，例如 <code>sum_data</code> 已儲存著 <code>cut</code> 當中各類別的次數 (<code>count</code>)：</p>
<div class="sourceCode" id="cb318"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">sum_data</span> <span class="op">&lt;-</span> <span class="va">diam</span> <span class="op">%&gt;%</span> 
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html">group_by</a></span><span class="op">(</span><span class="va">cut</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html">summarise</a></span><span class="op">(</span>count <span class="op">=</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/context.html">n</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="va">sum_data</span></code></pre></div>
<pre><code>#&gt; # A tibble: 5 x 2
#&gt;   cut       count
#&gt;   &lt;ord&gt;     &lt;int&gt;
#&gt; 1 Fair         41
#&gt; 2 Good        139
#&gt; 3 Very Good   366
#&gt; 4 Premium     390
#&gt; 5 Ideal       564</code></pre>
</li>
<li><p>如果想使用 <code>sum_data</code> 之中的變項<strong>直接</strong>去畫出長條圖，就需要覆寫 「<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 自動從 <code>x</code> 計算出次數」的預設行為。這個行為可由 <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 的 <code>stat</code> 參數進行設定。</p></li>
<li><p><code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 的 <code>stat</code> 預設值是 <code>"count"</code>，讓 <code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 可以從「對應至 <code>x</code> 的變項」計算出此變項裡各類別的次數。</p></li>
<li>
<p>若不想自動進行這種計算，而想直接使用 data frame 本身的變項，則可以將 <code>stat</code> 設為 <code>"identity"</code>，此時便可以在 <code>mapping</code> 中<strong>直接</strong>將 data frame 的變項對應至長條圖的 x 軸 與 y 軸：</p>
<div class="sourceCode" id="cb320"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># stat = "identity"</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">sum_data</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cut</span>, y <span class="op">=</span> <span class="va">count</span><span class="op">)</span>,
           stat <span class="op">=</span> <span class="st">"identity"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'stat = "identity"'</span><span class="op">)</span>

<span class="co"># stat = "count" (geom_bar 預設)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cut</span><span class="op">)</span>,
           stat <span class="op">=</span> <span class="st">"count"</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">labs</a></span><span class="op">(</span>title <span class="op">=</span> <span class="st">'stat = "count" (default)'</span><span class="op">)</span></code></pre></div>
<p><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-98-1.png" width="49%"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-98-2.png" width="49%"></p>
</li>
</ul>
<div id="geom_-與-stat-預設" class="section level3" number="5.7.1">
<h3>
<span class="header-section-number">5.7.1</span> <code>geom_*()</code> 與 <code>stat</code> 預設<a class="anchor" aria-label="anchor" href="#geom_-%E8%88%87-stat-%E9%A0%90%E8%A8%AD"><i class="fas fa-link"></i></a>
</h3>
<ul>
<li>所有的 <code>geom_*()</code> 函數都會有一個 <code>stat</code> 的預設值：
<ul>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point()</a></code> 預設 <code>stat = "identity"</code>，所以給定 <code>x</code> 與 <code>y</code> 兩個 mapping，便會將 data frame 中的變項對應至圖上的 x 軸與 y 軸。</li>
<li>
<code><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar()</a></code> 預設 <code>stat = "count"</code>，會從對應至 <code>x</code> 的變項中計算出該變項各個類別的次數，並將此次數繪於圖上的 y 軸</li>
</ul>
</li>
</ul>
</div>
</div>
<div id="position-adjustments" class="section level2" number="5.8">
<h2>
<span class="header-section-number">5.8</span> Position Adjustments<a class="anchor" aria-label="anchor" href="#position-adjustments"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>透過提供第二個 mapping, <code>fill</code>, <code>geom_bar</code> 能夠將每個長條再依據第二個類別變項進行細分。</li>
</ul>
<div class="sourceCode" id="cb321"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cut</span>, fill <span class="op">=</span> <span class="va">clarity</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-99-1.png" width="75%" style="display: block; margin: auto;"></div>
<div class="sourceCode" id="cb322"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># position: stack (default)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cut</span>, fill <span class="op">=</span> <span class="va">clarity</span><span class="op">)</span>,
           position <span class="op">=</span> <span class="st">"stack"</span><span class="op">)</span>

<span class="co"># position: fill</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cut</span>, fill <span class="op">=</span> <span class="va">clarity</span><span class="op">)</span>,
           position <span class="op">=</span> <span class="st">"fill"</span><span class="op">)</span>

<span class="co"># postion: dodge</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html">geom_bar</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">cut</span>, fill <span class="op">=</span> <span class="va">clarity</span><span class="op">)</span>,
           position <span class="op">=</span> <span class="st">"dodge"</span><span class="op">)</span></code></pre></div>
<p><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-100-1.png" width="33%"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-100-2.png" width="33%"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-100-3.png" width="33%"></p>
</div>
<div id="template-2" class="section level2" number="5.9">
<h2>
<span class="header-section-number">5.9</span> Template 2<a class="anchor" aria-label="anchor" href="#template-2"><i class="fas fa-link"></i></a>
</h2>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  )</code></pre>
</div>
<div id="facet" class="section level2" number="5.10">
<h2>
<span class="header-section-number">5.10</span> Facet<a class="anchor" aria-label="anchor" href="#facet"><i class="fas fa-link"></i></a>
</h2>
<ul>
<li>
<p>1 個類別變項</p>
<div class="sourceCode" id="cb324"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span>, y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html">facet_wrap</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">cut</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-101-1.png" width="75%" style="display: block; margin: auto;"></div>
</li>
<li>
<p>2 個類別變項</p>
<div class="sourceCode" id="cb325"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">diam</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">carat</span>, 
                               y <span class="op">=</span> <span class="va">price</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
      <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/facet_grid.html">facet_grid</a></span><span class="op">(</span>rows <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">cut</span><span class="op">)</span>,
                 cols <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/vars.html">vars</a></span><span class="op">(</span><span class="va">clarity</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<div class="inline-figure"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-102-1.png" width="75%" style="display: block; margin: auto;"></div>
</li>
</ul>
</div>
<div id="template-3" class="section level2" number="5.11">
<h2>
<span class="header-section-number">5.11</span> Template 3<a class="anchor" aria-label="anchor" href="#template-3"><i class="fas fa-link"></i></a>
</h2>
<pre><code>ggplot(data = &lt;DATA&gt;) + 
  &lt;GEOM_FUNCTION&gt;(
     mapping = aes(&lt;MAPPINGS&gt;),
     stat = &lt;STAT&gt;, 
     position = &lt;POSITION&gt;
  ) +
  &lt;FACET_FUNCTION&gt;</code></pre>
</div>
<div id="geoms" class="section level2" number="5.12">
<h2>
<span class="header-section-number">5.12</span> Geoms<a class="anchor" aria-label="anchor" href="#geoms"><i class="fas fa-link"></i></a>
</h2>
<div class="sourceCode" id="cb327"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">hwy</span><span class="op">)</span><span class="op">)</span>
<span class="co">#ggsave('mpg_class_hwy_point.png', width = 14, height = 12, units = 'cm')</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_boxplot.html">geom_boxplot</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">hwy</span><span class="op">)</span><span class="op">)</span>
<span class="co">#ggsave('mpg_class_hwy_boxplot.png', width = 14, height = 12, units = 'cm')</span>

<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">mpg</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span><span class="va">class</span>, <span class="va">hwy</span>, color <span class="op">=</span> <span class="va">drv</span><span class="op">)</span><span class="op">)</span>
<span class="co">#ggsave('mpg_class_hwy_color.png', width = 16, height = 12, units = 'cm')</span></code></pre></div>
<p><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-103-1.png" width="33%"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-103-2.png" width="33%"><img src="rlads2021LabSession_files/figure-html/unnamed-chunk-103-3.png" width="33%"></p>
</div>
<div id="參考資源-務必閱讀" class="section level2 unnumbered">
<h2>參考資源 (務必閱讀)<a class="anchor" aria-label="anchor" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%BA%90-%E5%8B%99%E5%BF%85%E9%96%B1%E8%AE%80"><i class="fas fa-link"></i></a>
</h2>
<ol style="list-style-type: decimal">
<li>Wickham, H., &amp; Grolemund, G. (2017). <strong><em>R for Data Science</em></strong>: <a href="https://r4ds.had.co.nz/data-visualisation">Data visualisation</a>
</li>
</ol>
</div>
</div>

  <div class="chapter-nav">
<div class="prev"><a href="ch04.html"><span class="header-section-number">4</span> Data Frame 處理：dplyr</a></div>
<div class="next"><a href="ch06.html"><span class="header-section-number">6</span> Simulating Data with R</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#ch05"><span class="header-section-number">5</span> 視覺化：ggplot2</a></li>
<li><a class="nav-link" href="#r-%E7%9A%84%E7%B9%AA%E5%9C%96%E7%B3%BB%E7%B5%B1"><span class="header-section-number">5.1</span> R 的繪圖系統</a></li>
<li><a class="nav-link" href="#%E4%BB%8A%E5%A4%A9%E7%94%A8%E5%88%B0%E7%9A%84%E8%B3%87%E6%96%99-diamonds"><span class="header-section-number">5.2</span> 今天用到的資料: diamonds</a></li>
<li>
<a class="nav-link" href="#template-1"><span class="header-section-number">5.3</span> Template 1</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#%E6%95%A3%E5%B8%83%E5%9C%96-scatter-plot"><span class="header-section-number">5.3.1</span> 散布圖 (Scatter plot)</a></li></ul>
</li>
<li><a class="nav-link" href="#%E5%9C%96%E5%B1%A4"><span class="header-section-number">5.4</span> 圖層</a></li>
<li><a class="nav-link" href="#mapping-%E5%B0%87%E8%B3%87%E6%96%99%E5%B0%8D%E6%87%89%E8%87%B3%E8%A6%96%E8%A6%BA%E5%B1%AC%E6%80%A7"><span class="header-section-number">5.5</span> Mapping: 將資料對應至視覺屬性</a></li>
<li><a class="nav-link" href="#%E9%95%B7%E6%A2%9D%E5%9C%96-bar-chart"><span class="header-section-number">5.6</span> 長條圖 (Bar chart)</a></li>
<li>
<a class="nav-link" href="#statistical-transformations"><span class="header-section-number">5.7</span> Statistical Transformations</a><ul class="nav navbar-nav"><li><a class="nav-link" href="#geom_-%E8%88%87-stat-%E9%A0%90%E8%A8%AD"><span class="header-section-number">5.7.1</span> geom_*() 與 stat 預設</a></li></ul>
</li>
<li><a class="nav-link" href="#position-adjustments"><span class="header-section-number">5.8</span> Position Adjustments</a></li>
<li><a class="nav-link" href="#template-2"><span class="header-section-number">5.9</span> Template 2</a></li>
<li><a class="nav-link" href="#facet"><span class="header-section-number">5.10</span> Facet</a></li>
<li><a class="nav-link" href="#template-3"><span class="header-section-number">5.11</span> Template 3</a></li>
<li><a class="nav-link" href="#geoms"><span class="header-section-number">5.12</span> Geoms</a></li>
<li><a class="nav-link" href="#%E5%8F%83%E8%80%83%E8%B3%87%E6%BA%90-%E5%8B%99%E5%BF%85%E9%96%B1%E8%AE%80">參考資源 (務必閱讀)</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/rlads2021/LabBook/blob/master/05-ggplot2.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/rlads2021/LabBook/edit/master/05-ggplot2.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>RLads Lab</strong>" was written by Yongfu Liao. It was last built on <span class="date">May 24, 2021</span>.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>
</html>
